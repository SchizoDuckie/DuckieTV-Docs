<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>DuckieTV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type="text/css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/cayman.css">
    <link rel="stylesheet" href="../css/prism.css">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">DuckieTV</h1>
      <h2 class="project-tagline">DuckieTV helps you manage your favorite TV Shows on a sweet calendar</h2><a href="https://npmjs.com/package/DuckieTV-Standalone" target="_blank" class="btn">View on npm</a>
    </section>
    <section data-spy="scroll" data-target=".scrollspy" class="main-content">
      <div class="row">
        <div class="col-md-3 col-xs-3 bs-docs-sidebar">
          <ul id="sidebar" class="nav nav-stacked fixed">
            <li><a href="../index.html">Main</a></li>
            <li><a href="../CRUD.entities.js.html">CRUD.entities.js</a></li>
            <li><a href="../app.authHttpBackend.js.html">app.authHttpBackend.js</a></li>
            <li><a href="../app.js.html">app.js</a></li>
            <li><a href="../app.requestinterceptors.js.html">app.requestinterceptors.js</a></li>
            <li><a href="../app.routes.js.html">app.routes.js</a></li>
            <li><a href="../app.standalone.systray.js.html">app.standalone.systray.js</a></li>
            <li><a href="../app.standalone.update.js.html">app.standalone.update.js</a></li>
            <li><a href="../app.standalone.windowdressing.js.html">app.standalone.windowdressing.js</a></li>
            <li><a href="../app.standalone.zoom.js.html">app.standalone.zoom.js</a></li>
            <li><a href="../app.translate.js.html">app.translate.js</a></li>
            <li><a href="../background.js.html">background.js</a></li>
            <li><a href="../classes/RemoteAPI.js.html">classes/RemoteAPI.js</a></li>
            <li><a href="../controllers/ActionBarCtrl.js.html">controllers/ActionBarCtrl.js</a></li>
            <li><a href="../controllers/WatchlistCtrl.js.html">controllers/WatchlistCtrl.js</a></li>
            <li><a href="../controllers/serieslist/LocalSeriesCtrl.js.html">controllers/serieslist/LocalSeriesCtrl.js</a></li>
            <li><a href="../controllers/serieslist/SeriesListCtrl.js.html">controllers/serieslist/SeriesListCtrl.js</a></li>
            <li><a href="../controllers/serieslist/TraktTVSearchCtrl.js.html">controllers/serieslist/TraktTVSearchCtrl.js</a></li>
            <li><a href="../controllers/serieslist/TraktTVTrendingCtrl.js.html">controllers/serieslist/TraktTVTrendingCtrl.js</a></li>
            <li><a href="../controllers/settings/BackupCtrl.js.html">controllers/settings/BackupCtrl.js</a></li>
            <li><a href="../controllers/settings/CalendarCtrl.js.html">controllers/settings/CalendarCtrl.js</a></li>
            <li><a href="../controllers/settings/DisplayCtrl.js.html">controllers/settings/DisplayCtrl.js</a></li>
            <li><a href="../controllers/settings/LanguageCtrl.js.html">controllers/settings/LanguageCtrl.js</a></li>
            <li><a href="../controllers/settings/SerieTorrentSettingsCtrl.js.html">controllers/settings/SerieTorrentSettingsCtrl.js</a></li>
            <li><a href="../controllers/settings/SettingsTorrentCtrl.js.html">controllers/settings/SettingsTorrentCtrl.js</a></li>
            <li><a href="../controllers/settings/SubtitlesCtrl.js.html">controllers/settings/SubtitlesCtrl.js</a></li>
            <li><a href="../controllers/settings/SyncCtrl.js.html">controllers/settings/SyncCtrl.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/Deluge.js.html">controllers/settings/TorrentClients/Deluge.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/Tixati.js.html">controllers/settings/TorrentClients/Tixati.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/Transmission.js.html">controllers/settings/TorrentClients/Transmission.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/Vuze.js.html">controllers/settings/TorrentClients/Vuze.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/qBittorrent.js.html">controllers/settings/TorrentClients/qBittorrent.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/qBittorrent32plus.js.html">controllers/settings/TorrentClients/qBittorrent32plus.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/uTorrentWebUI.js.html">controllers/settings/TorrentClients/uTorrentWebUI.js</a></li>
            <li><a href="../controllers/settings/TraktTVCtrl.js.html">controllers/settings/TraktTVCtrl.js</a></li>
            <li><a href="../controllers/settings/customSearchEngineCtrl.js.html">controllers/settings/customSearchEngineCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/AboutCtrl.js.html">controllers/sidepanel/AboutCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SettingsCtrl.js.html">controllers/sidepanel/SettingsCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelEpisodeCtrl.js.html">controllers/sidepanel/SidepanelEpisodeCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelSeasonCtrl.js.html">controllers/sidepanel/SidepanelSeasonCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelSeasonsCtrl.js.html">controllers/sidepanel/SidepanelSeasonsCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelSerieCtrl.js.html">controllers/sidepanel/SidepanelSerieCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelTraktSerieCtrl.js.html">controllers/sidepanel/SidepanelTraktSerieCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/TorrentCtrl.js.html">controllers/sidepanel/TorrentCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/TorrentDetailsCtrl.js.html">controllers/sidepanel/TorrentDetailsCtrl.js</a></li>
            <li><a href="../directives/backgroundRotator.js.html">directives/backgroundRotator.js</a></li>
            <li><a href="../directives/calendar.js.html">directives/calendar.js</a></li>
            <li><a href="../directives/calendarEvent.js.html">directives/calendarEvent.js</a></li>
            <li><a href="../directives/chromeTopSites.js.html">directives/chromeTopSites.js</a></li>
            <li><a href="../directives/datePicker.js.html">directives/datePicker.js</a></li>
            <li><a href="../directives/episodeDownloaded.js.html">directives/episodeDownloaded.js</a></li>
            <li><a href="../directives/episodeWatched.js.html">directives/episodeWatched.js</a></li>
            <li><a href="../directives/fastSearch.js.html">directives/fastSearch.js</a></li>
            <li><a href="../directives/focusWatch.js.html">directives/focusWatch.js</a></li>
            <li><a href="../directives/lazyBackground.js.html">directives/lazyBackground.js</a></li>
            <li><a href="../directives/loadingSpinner.js.html">directives/loadingSpinner.js</a></li>
            <li><a href="../directives/mouseWheelDown.js.html">directives/mouseWheelDown.js</a></li>
            <li><a href="../directives/mouseWheelUp.js.html">directives/mouseWheelUp.js</a></li>
            <li><a href="../directives/queryMonitor.js.html">directives/queryMonitor.js</a></li>
            <li><a href="../directives/serieDetails.js.html">directives/serieDetails.js</a></li>
            <li><a href="../directives/serieheader.js.html">directives/serieheader.js</a></li>
            <li><a href="../directives/seriesList.js.html">directives/seriesList.js</a></li>
            <li><a href="../directives/sidePanel.js.html">directives/sidePanel.js</a></li>
            <li><a href="../directives/stopEvent.js.html">directives/stopEvent.js</a></li>
            <li><a href="../directives/subtitleDialog.js.html">directives/subtitleDialog.js</a></li>
            <li><a href="../directives/targetBlank.js.html">directives/targetBlank.js</a></li>
            <li><a href="../directives/torrentDialog.js.html">directives/torrentDialog.js</a></li>
            <li><a href="../directives/torrentRemoteControl.js.html">directives/torrentRemoteControl.js</a></li>
            <li class="active"><a href="../services/AutoDownloadService.js.html">services/AutoDownloadService.js
                <ul class="nav nav-stacked">
                  <li><a href="#filterByScore"><i class="alert alert-info"></i><span>filterByScore</span></a>
                  </li>
                </ul></a></li>
            <li><a href="../services/BaseHTTPApi.js.html">services/BaseHTTPApi.js</a></li>
            <li><a href="../services/CalendarEvents.js.html">services/CalendarEvents.js</a></li>
            <li><a href="../services/ChromeStorageSyncTarget.js.html">services/ChromeStorageSyncTarget.js</a></li>
            <li><a href="../services/DuckieTorrent.js.html">services/DuckieTorrent.js</a></li>
            <li><a href="../services/EpisodeWatchedMonitor.js.html">services/EpisodeWatchedMonitor.js</a></li>
            <li><a href="../services/FavoritesService.js.html">services/FavoritesService.js</a></li>
            <li><a href="../services/FileReader.js.html">services/FileReader.js</a></li>
            <li><a href="../services/FormlyLoaderService.js.html">services/FormlyLoaderService.js</a></li>
            <li><a href="../services/GoogleImages.js.html">services/GoogleImages.js</a></li>
            <li><a href="../services/IMDB.js.html">services/IMDB.js</a></li>
            <li><a href="../services/MigrationService.js.html">services/MigrationService.js</a></li>
            <li><a href="../services/Netflix.js.html">services/Netflix.js</a></li>
            <li><a href="../services/NotificationService.js.html">services/NotificationService.js</a></li>
            <li><a href="../services/OpenSubtitles.js.html">services/OpenSubtitles.js</a></li>
            <li><a href="../services/PowderPlayer.js.html">services/PowderPlayer.js</a></li>
            <li><a href="../services/SceneNameResolver.js.html">services/SceneNameResolver.js</a></li>
            <li><a href="../services/SceneXemResolver.js.html">services/SceneXemResolver.js</a></li>
            <li><a href="../services/SettingsService.js.html">services/SettingsService.js</a></li>
            <li><a href="../services/StorageSyncService.js.html">services/StorageSyncService.js</a></li>
            <li><a href="../services/SyncManager.js.html">services/SyncManager.js</a></li>
            <li><a href="../services/TorrentClients/BaseTorrentClient.js.html">services/TorrentClients/BaseTorrentClient.js</a></li>
            <li><a href="../services/TorrentClients/Deluge.js.html">services/TorrentClients/Deluge.js</a></li>
            <li><a href="../services/TorrentClients/Tixati.js.html">services/TorrentClients/Tixati.js</a></li>
            <li><a href="../services/TorrentClients/TorrentData.js.html">services/TorrentClients/TorrentData.js</a></li>
            <li><a href="../services/TorrentClients/Transmission.js.html">services/TorrentClients/Transmission.js</a></li>
            <li><a href="../services/TorrentClients/Vuze.js.html">services/TorrentClients/Vuze.js</a></li>
            <li><a href="../services/TorrentClients/qBittorrent.js.html">services/TorrentClients/qBittorrent.js</a></li>
            <li><a href="../services/TorrentClients/qBittorrent32plus.js.html">services/TorrentClients/qBittorrent32plus.js</a></li>
            <li><a href="../services/TorrentClients/uTorrent.js.html">services/TorrentClients/uTorrent.js</a></li>
            <li><a href="../services/TorrentClients/uTorrentWebUI.js.html">services/TorrentClients/uTorrentWebUI.js</a></li>
            <li><a href="../services/TorrentFreak.js.html">services/TorrentFreak.js</a></li>
            <li><a href="../services/TorrentHashListService.js.html">services/TorrentHashListService.js</a></li>
            <li><a href="../services/TorrentMonitor.js.html">services/TorrentMonitor.js</a></li>
            <li><a href="../services/TorrentSearchEngines/GenericTorrentSearchEngine.js.html">services/TorrentSearchEngines/GenericTorrentSearchEngine.js</a></li>
            <li><a href="../services/TorrentSearchEngines/Kickass.js.html">services/TorrentSearchEngines/Kickass.js</a></li>
            <li><a href="../services/TorrentSearchEngines/KickassMirrorResolver.js.html">services/TorrentSearchEngines/KickassMirrorResolver.js</a></li>
            <li><a href="../services/TorrentSearchEngines/Nyaa.js.html">services/TorrentSearchEngines/Nyaa.js</a></li>
            <li><a href="../services/TorrentSearchEngines/RarBG.js.html">services/TorrentSearchEngines/RarBG.js</a></li>
            <li><a href="../services/TorrentSearchEngines/ShowRSS.js.html">services/TorrentSearchEngines/ShowRSS.js</a></li>
            <li><a href="../services/TorrentSearchEngines/Strike.js.html">services/TorrentSearchEngines/Strike.js</a></li>
            <li><a href="../services/TorrentSearchEngines/ThePirateBay.js.html">services/TorrentSearchEngines/ThePirateBay.js</a></li>
            <li><a href="../services/TorrentSearchEngines/ThePirateBayMirrorResolver.js.html">services/TorrentSearchEngines/ThePirateBayMirrorResolver.js</a></li>
            <li><a href="../services/TorrentSearchEngines/TorrentSearchEngines.js.html">services/TorrentSearchEngines/TorrentSearchEngines.js</a></li>
            <li><a href="../services/TorrentSearchEngines/Torrentz.eu.js.html">services/TorrentSearchEngines/Torrentz.eu.js</a></li>
            <li><a href="../services/TraktTVStorageSyncTarget.js.html">services/TraktTVStorageSyncTarget.js</a></li>
            <li><a href="../services/TraktTVTrending.js.html">services/TraktTVTrending.js</a></li>
            <li><a href="../services/TraktTVUpdateService.js.html">services/TraktTVUpdateService.js</a></li>
            <li><a href="../services/TraktTVv2.js.html">services/TraktTVv2.js</a></li>
            <li><a href="../services/UpgradeNotificationService.js.html">services/UpgradeNotificationService.js</a></li>
            <li><a href="../services/WatchlistCheckerService.js.html">services/WatchlistCheckerService.js</a></li>
            <li><a href="../services/WatchlistService.js.html">services/WatchlistService.js</a></li>
            <li><a href="../utility.js.html">utility.js</a></li>
          </ul>
        </div>
        <div class="col-md-9">
          <div class="description"><p>The AutoDownloadService checks if a download is available for a TV-Show that&#39;s aired<br />and automatically downloads the first search result if more than minSeeders seeders are available.</p></div>
          <pre><code class="language-javascript">DuckieTV

.factory('AutoDownloadService', [&quot;$rootScope&quot;, &quot;FavoritesService&quot;, &quot;SceneNameResolver&quot;, &quot;SettingsService&quot;, &quot;TorrentSearchEngines&quot;, &quot;DuckieTorrent&quot;, &quot;TorrentHashListService&quot;,
    function($rootScope, FavoritesService, SceneNameResolver, SettingsService, TorrentSearchEngines, DuckieTorrent, TorrentHashListService) {

        var period = SettingsService.get('autodownload.period'); // Period to check for updates up until today current time, default 1
        var minSeeders = SettingsService.get('autodownload.minSeeders'); // Minimum amount of seeders required, default 50

        var service = {
            checkTimeout: null,
            autoDownloadCheck: function() {
                //console.debug(&quot;Episode air check fired&quot;);
                if (SettingsService.get('torrenting.autodownload') === false) {
                    service.detach();
                    return;
                }

                var lastRun = SettingsService.get('autodownload.lastrun'),
                    from = new Date();
                if (lastRun) {
                    from = new Date(lastRun);
                }
                from.setDate(from.getDate() - period); // substract autodownload period from lastrun for if some episodes weren't downloaded.
                from.setHours(0);
                from.setMinutes(0);
                from.setSeconds(0);

                if (DuckieTorrent.getClient().isConnected()) {
                    DuckieTorrent.getClient().AutoConnect().then(function(remote) {
                        // Get the list of episodes that have aired since period, and iterate them.
                        FavoritesService.getEpisodesForDateRange(from.getTime(), new Date().getTime()).then(function(candidates) {
                            candidates.map(function(episode, episodeIndex) {
                                if (episode.isDownloaded()) return; // if the episode was already downloaded, skip it.
                                if (episode.watchedAt !== null) return; // if the episode has been marked as watched, skip it.
                                if (episode.magnetHash !== null &amp;&amp; (episode.magnetHash in remote.torrents)) return; // if the episode was already downloaded, skip it.

                                CRUD.FindOne('Serie', {
                                    ID_Serie: episode.ID_Serie
                                }).then(function(serie) {
                                    if (serie.autoDownload == 1) {
                                        service.autoDownload(serie, episode, episodeIndex).then(function(result) {
                                            if (result) {
                                                // store the magnet hash on the episode and notify the listeners of the change
                                                $rootScope.$broadcast('magnet:select:' + episode.TVDB_ID, [result]);
                                            }
                                        });
                                    }
                                });
                            });
                            SettingsService.set('autodownload.lastrun', new Date().getTime());
                        });
                    });

                }

                service.checkTimeout = setTimeout(service.autoDownloadCheck, 60000 * 15); // fire new episodeaired check in 15 minutes.
            },

            autoDownload: function(serie, episode, episodeIndex) {
                // Fetch the Scene Name for the series and compile the search string for the episode with the quality requirement.
                var q = SceneNameResolver.getSceneName(serie.TVDB_ID, serie.name) + ' ' + episode.getFormattedEpisode();
                var searchString = q + ' ' + $rootScope.getSetting('torrenting.searchquality');
                //console.debug(&quot;Auto download!&quot;, searchString);</code></pre>
          <section id="filterByScore">
            <h1>filterByScore</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>filterByScore()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Word-by-word scoring for search results.<br />All words need to be in the search result&#39;s release name, or the result will be filtered out.</p></div>
          <pre><code class="language-javascript">function filterByScore(item) {
    var score = 0;
    var query = q.toLowerCase().split(' ');
    name = item.releasename.toLowerCase();
    query.map(function(part) {
        if (name.indexOf(part) &gt; -1) {
            score++;
        }
    });
    return (score == query.length);
}

var episodestring = 0;
// Search torrent provider for the string
return TorrentSearchEngines.getDefaultEngine().search(searchString, true).then(function(results) {
    var items = results.filter(filterByScore);
    if (items.length === 0) {
        return; // no results, abort
    }
    if (items[0].seeders == 'N/A' || parseInt(items[0].seeders, 10) &gt;= minSeeders) { // enough seeders are available.
        var url = items[0].magneturl;
        var torrentHash = url.match(/([0-9ABCDEFabcdef]{40})/)[0].toUpperCase();
        // launch the magnet uri via the TorrentSearchEngines's launchMagnet Method
        DuckieTorrent.getClient().AutoConnect().then(function() {
            TorrentSearchEngines.launchMagnet(url, serie.TVDB_ID, true);
            episode.magnetHash = torrentHash;
            episode.Persist();
            // record that this magnet was launched under DuckieTV's control. Used by auto-Stop.
            TorrentHashListService.addToHashList(torrentHash);
        });
        return torrentHash;
    }
});
            },
            attach: function() {
if (!service.checkTimeout) {
    service.checkTimeout = setTimeout(service.autoDownloadCheck, 5000);
    $rootScope.$on('torrentclient:connected', function(remote) {
        console.log(&quot; Caught TorrentClient connected event! starting autodownloadcheck!&quot;);
        service.autoDownloadCheck();
    });
}
            },
            detach: function() {
clearTimeout(service.checkTimeout);
service.checkTimeout = null;
            }
        };
        return service;
    }
])</code></pre>
          <div class="description"><p>Attach auto-download check interval when enabled.</p></div>
          <pre><code class="language-javascript">.run([&quot;$rootScope&quot;, &quot;AutoDownloadService&quot;, &quot;SettingsService&quot;,
    function($rootScope, AutoDownloadService, SettingsService) {

        if (SettingsService.get('torrenting.enabled') === true &amp;&amp; SettingsService.get('torrenting.autodownload') === true) {
            setTimeout(function() {
                console.info('Initializing AutoDownload Service!');
                AutoDownloadService.attach();
            }, 5000);
        }
    }
]);</code></pre>
          <div class="footer site-footer">
            <div class="span site-footer-owner"><a href="https://github.com/mr-doc/mr-doc-theme-cayman">Cayman</a> is maintained by <a href="https://github.com/iwatakeshi">iwatakeshi</a>.</div>
            <div class="span site-footer-credits">This page was generated by <a href="https://github.com/mr-doc/mr-doc">Mr. Doc</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</div>
          </div>
        </div>
      </div>
    </section>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/affix.js"></script>
    <script src="../js/dropdown.js"></script>
    <script src="../js/scrollspy.js"></script>
    <script src="../js/prism.js"></script>
    <script src="../js/prism-bash.js"></script>
    <script>
      $(document).ready(function(){
        $('body').scrollspy({
          target: ".bs-docs-sidebar",
          offset: 40
        });
        $('#sidebar').affix({
          offset:{
            bottom:60,
            top: 60
          }
        }) 
      });
    </script>
  </body>
</html>