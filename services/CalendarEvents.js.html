<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>DuckieTV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type="text/css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/cayman.css">
    <link rel="stylesheet" href="../css/prism.css">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">DuckieTV</h1>
      <h2 class="project-tagline">DuckieTV helps you manage your favorite TV Shows on a sweet calendar</h2><a href="https://npmjs.com/package/DuckieTV-Standalone" target="_blank" class="btn">View on npm</a>
    </section>
    <section data-spy="scroll" data-target=".scrollspy" class="main-content">
      <div class="row">
        <div class="col-md-3 col-xs-3 bs-docs-sidebar">
          <ul id="sidebar" class="nav nav-stacked fixed">
            <li><a href="../index.html">Main</a></li>
            <li><a href="../CRUD.entities.js.html">CRUD.entities.js</a></li>
            <li><a href="../app.authHttpBackend.js.html">app.authHttpBackend.js</a></li>
            <li><a href="../app.js.html">app.js</a></li>
            <li><a href="../app.requestinterceptors.js.html">app.requestinterceptors.js</a></li>
            <li><a href="../app.routes.js.html">app.routes.js</a></li>
            <li><a href="../app.standalone.systray.js.html">app.standalone.systray.js</a></li>
            <li><a href="../app.standalone.update.js.html">app.standalone.update.js</a></li>
            <li><a href="../app.standalone.windowdressing.js.html">app.standalone.windowdressing.js</a></li>
            <li><a href="../app.standalone.zoom.js.html">app.standalone.zoom.js</a></li>
            <li><a href="../app.translate.js.html">app.translate.js</a></li>
            <li><a href="../background.js.html">background.js</a></li>
            <li><a href="../classes/RemoteAPI.js.html">classes/RemoteAPI.js</a></li>
            <li><a href="../controllers/ActionBarCtrl.js.html">controllers/ActionBarCtrl.js</a></li>
            <li><a href="../controllers/WatchlistCtrl.js.html">controllers/WatchlistCtrl.js</a></li>
            <li><a href="../controllers/serieslist/LocalSeriesCtrl.js.html">controllers/serieslist/LocalSeriesCtrl.js</a></li>
            <li><a href="../controllers/serieslist/SeriesListCtrl.js.html">controllers/serieslist/SeriesListCtrl.js</a></li>
            <li><a href="../controllers/serieslist/TraktTVSearchCtrl.js.html">controllers/serieslist/TraktTVSearchCtrl.js</a></li>
            <li><a href="../controllers/serieslist/TraktTVTrendingCtrl.js.html">controllers/serieslist/TraktTVTrendingCtrl.js</a></li>
            <li><a href="../controllers/settings/BackupCtrl.js.html">controllers/settings/BackupCtrl.js</a></li>
            <li><a href="../controllers/settings/CalendarCtrl.js.html">controllers/settings/CalendarCtrl.js</a></li>
            <li><a href="../controllers/settings/DisplayCtrl.js.html">controllers/settings/DisplayCtrl.js</a></li>
            <li><a href="../controllers/settings/LanguageCtrl.js.html">controllers/settings/LanguageCtrl.js</a></li>
            <li><a href="../controllers/settings/SerieTorrentSettingsCtrl.js.html">controllers/settings/SerieTorrentSettingsCtrl.js</a></li>
            <li><a href="../controllers/settings/SettingsTorrentCtrl.js.html">controllers/settings/SettingsTorrentCtrl.js</a></li>
            <li><a href="../controllers/settings/SubtitlesCtrl.js.html">controllers/settings/SubtitlesCtrl.js</a></li>
            <li><a href="../controllers/settings/SyncCtrl.js.html">controllers/settings/SyncCtrl.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/Deluge.js.html">controllers/settings/TorrentClients/Deluge.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/Tixati.js.html">controllers/settings/TorrentClients/Tixati.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/Transmission.js.html">controllers/settings/TorrentClients/Transmission.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/Vuze.js.html">controllers/settings/TorrentClients/Vuze.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/qBittorrent.js.html">controllers/settings/TorrentClients/qBittorrent.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/qBittorrent32plus.js.html">controllers/settings/TorrentClients/qBittorrent32plus.js</a></li>
            <li><a href="../controllers/settings/TorrentClients/uTorrentWebUI.js.html">controllers/settings/TorrentClients/uTorrentWebUI.js</a></li>
            <li><a href="../controllers/settings/TraktTVCtrl.js.html">controllers/settings/TraktTVCtrl.js</a></li>
            <li><a href="../controllers/settings/customSearchEngineCtrl.js.html">controllers/settings/customSearchEngineCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/AboutCtrl.js.html">controllers/sidepanel/AboutCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SettingsCtrl.js.html">controllers/sidepanel/SettingsCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelEpisodeCtrl.js.html">controllers/sidepanel/SidepanelEpisodeCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelSeasonCtrl.js.html">controllers/sidepanel/SidepanelSeasonCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelSeasonsCtrl.js.html">controllers/sidepanel/SidepanelSeasonsCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelSerieCtrl.js.html">controllers/sidepanel/SidepanelSerieCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/SidepanelTraktSerieCtrl.js.html">controllers/sidepanel/SidepanelTraktSerieCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/TorrentCtrl.js.html">controllers/sidepanel/TorrentCtrl.js</a></li>
            <li><a href="../controllers/sidepanel/TorrentDetailsCtrl.js.html">controllers/sidepanel/TorrentDetailsCtrl.js</a></li>
            <li><a href="../directives/backgroundRotator.js.html">directives/backgroundRotator.js</a></li>
            <li><a href="../directives/calendar.js.html">directives/calendar.js</a></li>
            <li><a href="../directives/calendarEvent.js.html">directives/calendarEvent.js</a></li>
            <li><a href="../directives/chromeTopSites.js.html">directives/chromeTopSites.js</a></li>
            <li><a href="../directives/datePicker.js.html">directives/datePicker.js</a></li>
            <li><a href="../directives/episodeDownloaded.js.html">directives/episodeDownloaded.js</a></li>
            <li><a href="../directives/episodeWatched.js.html">directives/episodeWatched.js</a></li>
            <li><a href="../directives/fastSearch.js.html">directives/fastSearch.js</a></li>
            <li><a href="../directives/focusWatch.js.html">directives/focusWatch.js</a></li>
            <li><a href="../directives/lazyBackground.js.html">directives/lazyBackground.js</a></li>
            <li><a href="../directives/loadingSpinner.js.html">directives/loadingSpinner.js</a></li>
            <li><a href="../directives/mouseWheelDown.js.html">directives/mouseWheelDown.js</a></li>
            <li><a href="../directives/mouseWheelUp.js.html">directives/mouseWheelUp.js</a></li>
            <li><a href="../directives/queryMonitor.js.html">directives/queryMonitor.js</a></li>
            <li><a href="../directives/serieDetails.js.html">directives/serieDetails.js</a></li>
            <li><a href="../directives/serieheader.js.html">directives/serieheader.js</a></li>
            <li><a href="../directives/seriesList.js.html">directives/seriesList.js</a></li>
            <li><a href="../directives/sidePanel.js.html">directives/sidePanel.js</a></li>
            <li><a href="../directives/stopEvent.js.html">directives/stopEvent.js</a></li>
            <li><a href="../directives/subtitleDialog.js.html">directives/subtitleDialog.js</a></li>
            <li><a href="../directives/targetBlank.js.html">directives/targetBlank.js</a></li>
            <li><a href="../directives/torrentDialog.js.html">directives/torrentDialog.js</a></li>
            <li><a href="../directives/torrentRemoteControl.js.html">directives/torrentRemoteControl.js</a></li>
            <li><a href="../services/AutoDownloadService.js.html">services/AutoDownloadService.js</a></li>
            <li><a href="../services/BaseHTTPApi.js.html">services/BaseHTTPApi.js</a></li>
            <li class="active"><a href="../services/CalendarEvents.js.html">services/CalendarEvents.js
                <ul class="nav nav-stacked">
                  <li><a href="#hasEvent"><i class="alert alert-info"></i><span>hasEvent</span></a>
                  </li>
                  <li><a href="#addEvent"><i class="alert alert-info"></i><span>addEvent</span></a>
                  </li>
                  <li><a href="#calendarEpisodeSort"><i class="alert alert-info"></i><span>calendarEpisodeSort</span></a>
                  </li>
                  <li><a href="#deleteDuplicates"><i class="alert alert-info"></i><span>deleteDuplicates</span></a>
                  </li>
                  <li><a href="#removeDeleted"><i class="alert alert-info"></i><span>removeDeleted</span></a>
                  </li>
                  <li><a href="#setVisibleDays"><i class="alert alert-info"></i><span>setVisibleDays</span></a>
                  </li>
                  <li><a href="#getEventsForDateRange"><i class="alert alert-info"></i><span>getEventsForDateRange</span></a>
                  </li>
                  <li><a href="#setEvents"><i class="alert alert-info"></i><span>setEvents</span></a>
                  </li>
                  <li><a href="#hasEvent"><i class="alert alert-info"></i><span>hasEvent</span></a>
                  </li>
                  <li><a href="#getEvents"><i class="alert alert-info"></i><span>getEvents</span></a>
                  </li>
                  <li><a href="#getSeries"><i class="alert alert-info"></i><span>getSeries</span></a>
                  </li>
                </ul></a></li>
            <li><a href="../services/ChromeStorageSyncTarget.js.html">services/ChromeStorageSyncTarget.js</a></li>
            <li><a href="../services/DuckieTorrent.js.html">services/DuckieTorrent.js</a></li>
            <li><a href="../services/EpisodeWatchedMonitor.js.html">services/EpisodeWatchedMonitor.js</a></li>
            <li><a href="../services/FavoritesService.js.html">services/FavoritesService.js</a></li>
            <li><a href="../services/FileReader.js.html">services/FileReader.js</a></li>
            <li><a href="../services/FormlyLoaderService.js.html">services/FormlyLoaderService.js</a></li>
            <li><a href="../services/GoogleImages.js.html">services/GoogleImages.js</a></li>
            <li><a href="../services/IMDB.js.html">services/IMDB.js</a></li>
            <li><a href="../services/MigrationService.js.html">services/MigrationService.js</a></li>
            <li><a href="../services/Netflix.js.html">services/Netflix.js</a></li>
            <li><a href="../services/NotificationService.js.html">services/NotificationService.js</a></li>
            <li><a href="../services/OpenSubtitles.js.html">services/OpenSubtitles.js</a></li>
            <li><a href="../services/PowderPlayer.js.html">services/PowderPlayer.js</a></li>
            <li><a href="../services/SceneNameResolver.js.html">services/SceneNameResolver.js</a></li>
            <li><a href="../services/SceneXemResolver.js.html">services/SceneXemResolver.js</a></li>
            <li><a href="../services/SettingsService.js.html">services/SettingsService.js</a></li>
            <li><a href="../services/StorageSyncService.js.html">services/StorageSyncService.js</a></li>
            <li><a href="../services/SyncManager.js.html">services/SyncManager.js</a></li>
            <li><a href="../services/TorrentClients/BaseTorrentClient.js.html">services/TorrentClients/BaseTorrentClient.js</a></li>
            <li><a href="../services/TorrentClients/Deluge.js.html">services/TorrentClients/Deluge.js</a></li>
            <li><a href="../services/TorrentClients/Tixati.js.html">services/TorrentClients/Tixati.js</a></li>
            <li><a href="../services/TorrentClients/TorrentData.js.html">services/TorrentClients/TorrentData.js</a></li>
            <li><a href="../services/TorrentClients/Transmission.js.html">services/TorrentClients/Transmission.js</a></li>
            <li><a href="../services/TorrentClients/Vuze.js.html">services/TorrentClients/Vuze.js</a></li>
            <li><a href="../services/TorrentClients/qBittorrent.js.html">services/TorrentClients/qBittorrent.js</a></li>
            <li><a href="../services/TorrentClients/qBittorrent32plus.js.html">services/TorrentClients/qBittorrent32plus.js</a></li>
            <li><a href="../services/TorrentClients/uTorrent.js.html">services/TorrentClients/uTorrent.js</a></li>
            <li><a href="../services/TorrentClients/uTorrentWebUI.js.html">services/TorrentClients/uTorrentWebUI.js</a></li>
            <li><a href="../services/TorrentFreak.js.html">services/TorrentFreak.js</a></li>
            <li><a href="../services/TorrentHashListService.js.html">services/TorrentHashListService.js</a></li>
            <li><a href="../services/TorrentMonitor.js.html">services/TorrentMonitor.js</a></li>
            <li><a href="../services/TorrentSearchEngines/GenericTorrentSearchEngine.js.html">services/TorrentSearchEngines/GenericTorrentSearchEngine.js</a></li>
            <li><a href="../services/TorrentSearchEngines/Kickass.js.html">services/TorrentSearchEngines/Kickass.js</a></li>
            <li><a href="../services/TorrentSearchEngines/KickassMirrorResolver.js.html">services/TorrentSearchEngines/KickassMirrorResolver.js</a></li>
            <li><a href="../services/TorrentSearchEngines/Nyaa.js.html">services/TorrentSearchEngines/Nyaa.js</a></li>
            <li><a href="../services/TorrentSearchEngines/RarBG.js.html">services/TorrentSearchEngines/RarBG.js</a></li>
            <li><a href="../services/TorrentSearchEngines/ShowRSS.js.html">services/TorrentSearchEngines/ShowRSS.js</a></li>
            <li><a href="../services/TorrentSearchEngines/Strike.js.html">services/TorrentSearchEngines/Strike.js</a></li>
            <li><a href="../services/TorrentSearchEngines/ThePirateBay.js.html">services/TorrentSearchEngines/ThePirateBay.js</a></li>
            <li><a href="../services/TorrentSearchEngines/ThePirateBayMirrorResolver.js.html">services/TorrentSearchEngines/ThePirateBayMirrorResolver.js</a></li>
            <li><a href="../services/TorrentSearchEngines/TorrentSearchEngines.js.html">services/TorrentSearchEngines/TorrentSearchEngines.js</a></li>
            <li><a href="../services/TorrentSearchEngines/Torrentz.eu.js.html">services/TorrentSearchEngines/Torrentz.eu.js</a></li>
            <li><a href="../services/TraktTVStorageSyncTarget.js.html">services/TraktTVStorageSyncTarget.js</a></li>
            <li><a href="../services/TraktTVTrending.js.html">services/TraktTVTrending.js</a></li>
            <li><a href="../services/TraktTVUpdateService.js.html">services/TraktTVUpdateService.js</a></li>
            <li><a href="../services/TraktTVv2.js.html">services/TraktTVv2.js</a></li>
            <li><a href="../services/UpgradeNotificationService.js.html">services/UpgradeNotificationService.js</a></li>
            <li><a href="../services/WatchlistCheckerService.js.html">services/WatchlistCheckerService.js</a></li>
            <li><a href="../services/WatchlistService.js.html">services/WatchlistService.js</a></li>
            <li><a href="../utility.js.html">utility.js</a></li>
          </ul>
        </div>
        <div class="col-md-9">
          <div class="description"><p>The CalendarEvents service provides storage and retrieve functions<br />for episodes that are displayed on the calendar. It has built-in cache<br />and watches for the calendar changing it&#39;s date before fetching a new<br />set of episodes from the database</p></div>
          <pre><code class="language-javascript">DuckieTV.factory('CalendarEvents', [&quot;$rootScope&quot;, &quot;FavoritesService&quot;, &quot;SettingsService&quot;,
    function($rootScope, FavoritesService, SettingsService) {

        var calendarEvents = {};
        var seriesForDate = {};
        var expandedSeries = {};
        var calendarEpisodeSortCache = {};
        var calendarStartDate = null;
        var calendarEndDate = null;
        var today = new Date();</code></pre>
          <section id="hasEvent">
            <h1>hasEvent</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>hasEvent()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Check if an episode already exists on a date in the calendar.</p></div>
          <pre><code class="language-javascript">function hasEvent(date, event) {
    return calendarEvents[date].filter(function(el) {
        return el.episode.getID() == event.episode.getID();
    }).length == 1;
}</code></pre>
          <section id="addEvent">
            <h1>addEvent</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>addEvent()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Add an event to the calendar if it&#39;s not already there.</p></div>
          <pre><code class="language-javascript">function addEvent(date, event) {
    if (!hasEvent(date, event)) {
        calendarEvents[date].push(event);
        calendarEvents[date].sort(calendarEpisodeSort);
        if (!(event.ID_Serie in seriesForDate[date])) {
            seriesForDate[date][event.ID_Serie] = [];
        }
        seriesForDate[date][event.ID_Serie].push(event);
        delete calendarEpisodeSortCache[date];
    }
}</code></pre>
          <section id="calendarEpisodeSort">
            <h1>calendarEpisodeSort</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>calendarEpisodeSort()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Sort the episodes for a specific date.<br />First by air time, then by episode number if multiple episodes for a serie,<br />then by title if multiple series at the same time.</p></div>
          <pre><code class="language-javascript">function calendarEpisodeSort(a, b) {
    var ad = new Date(a.episode.firstaired_iso).getTime();
    var bd = new Date(b.episode.firstaired_iso).getTime()
    if (ad &lt; bd) return -1;
    else if (ad &gt; bd) return 1;
    else {
        // air at the same time, now order by title first and if the names match by episode
        if (a.ID_Serie == b.ID_Serie) {
            if (a.episode.episodenumber &lt; b.episode.episodenumber) return -1;
            if (a.episode.episodenumber &gt; b.episode.episodenumber) return 1;

        } else {
            return a.serie.title &gt; b.serie.title;
        }
    }
}</code></pre>
          <section id="deleteDuplicates">
            <h1>deleteDuplicates</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>deleteDuplicates()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>If the episode exist in other dates in the calendarEvents object, remove it.</p></div>
          <pre><code class="language-javascript">function deleteDuplicates(duplicateID, eventDate) {
    for (var aDate in calendarEvents) {
        if (aDate !== eventDate) {
            var eventList = calendarEvents[aDate];
            for (var index = eventList.length - 1; index &gt; -1; index--) {
                if (eventList[index].episodeID === duplicateID) {
                    calendarEvents[aDate].splice(index, 1);
                    delete seriesForDate[aDate][eventList[index].TVDB_ID];
                    return;
                }
            }
        }
    }
}</code></pre>
          <section id="removeDeleted">
            <h1>removeDeleted</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>removeDeleted()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Remove shows that were deleted from the database from the calendar.</p></div>
          <pre><code class="language-javascript">function removeDeleted() {
    Object.keys(calendarEvents).map(function(date) {
        var eventList = calendarEvents[date];
        for (var index = eventList.length - 1; index &gt; -1; index--) {
            if (FavoritesService.favoriteIDs.indexOf(eventList[index].TVDB_ID) == -1) {
                calendarEvents[date].splice(index, 1);
            }
        }
    });
}

var service = {</code></pre>
          <section id="setVisibleDays">
            <h1>setVisibleDays</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>setVisibleDays()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>setVisibleDays function is called from the calendar directive.<br />It fills the CalendarEvents with days that are currently on display and makes sure<br />that days that are not currently displayed are purged from cache</p></div>
          <pre><code class="language-javascript">setVisibleDays: function(range) {
    if (!range || range.length == 1 &amp;&amp; range[0].length == 1) return;
    var dates = [];
    calendarStartDate = new Date(range[0][0]);
    calendarEndDate = new Date((range[range.length - 1][range[range.length - 1].length - 1].getTime()) + 86399999); // add 23:59:59 to endDate
    calendarEvents = {};
    seriesForDate = {};
    expandedSeries = {};
    range.map(function(week) {
        week.map(function(day) {
            day = new Date(day).toDateString();
            dates.push(day);
            if (!(day in calendarEvents)) {
                calendarEvents[day] = [];
                seriesForDate[day] = {};
            }
        })
    });
    Object.keys(calendarEvents).map(function(day) {
        if (dates.indexOf(day) == -1) {
            //console.debug(&quot;Cleaning up day: &quot;, day);
            delete calendarEvents[day];
            delete seriesForDate[day];
        }
    });
    service.getEventsForDateRange(calendarStartDate, calendarEndDate);
},</code></pre>
          <section id="getEventsForDateRange">
            <h1>getEventsForDateRange</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>getEventsForDateRange()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Optimized function to feed the calendar it&#39;s data.<br />Fetches the episodes for a date range and the relevant series for it. Then caches and refreshes the calendar</p></div>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Date</td>
                <td></td>
                <td><p>start startDate</p></td>
              </tr>
              <tr>
                <td>Date</td>
                <td></td>
                <td><p>end endDate</p></td>
              </tr>
            </tbody>
          </table>
          <pre><code class="language-javascript">getEventsForDateRange: function(start, end) {
    // fetch episodes between 2 timestamps
    return FavoritesService.getEpisodesForDateRange(start.getTime(), end.getTime()).then(function(episodes) {
        // iterate all the episodes and bind it together with the serie into an event array
        return service.setEvents(episodes.map(function(episode) {
            return {
                start: new Date(episode.firstaired),
                ID_Serie: episode.ID_Serie,
                serie: FavoritesService.getByID_Serie(episode.ID_Serie),
                episode: episode
            };
        }));
    });
},
clearCache: function() {
    calendarStartDate = null;
    calendarEndDate = null;
    calendarEvents = {};
},</code></pre>
          <section id="setEvents">
            <h1>setEvents</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>setEvents()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Merge any incoming new events with the events already in calendarEvents.<br />Removes any mention of the episode that already exists and then adds the new one.<br />The calendarEvents cache is updated per day so the calendar doesn&#39;t refresh unnecessarily</p></div>
          <pre><code class="language-javascript">setEvents: function(events) {
    removeDeleted();
    events.map(function(event) {
        var date = new Date(new Date(event.start).getTime()).toDateString();
        if (!(date in calendarEvents)) return;
        deleteDuplicates(event.episode.getID(), date);
        addEvent(date, event);
    });
    $rootScope.$applyAsync();
},

processEpisodes: function(serie, seasons) {
    //console.debug(&quot;Process episodes &quot;, serie.name, seasons);
    var filtered = [];
    seasons.map(function(episodes) {
        Object.keys(episodes).map(function(id) {
            var date = new Date(new Date(episodes[id].firstaired).getTime()).toDateString();
            //console.debug(&quot;matching date: &quot;, date, calendarEvents[date]);
            if (!(date in calendarEvents)) return;

            addEvent(date, {
                start: new Date(episodes[id].firstaired),
                ID_Serie: episodes[id].ID_Serie,
                serie: serie,
                episode: episodes[id]
            });
        });
    });
    $rootScope.$applyAsync();
},</code></pre>
          <section id="hasEvent">
            <h1>hasEvent</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>hasEvent()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Check if an event exists at the given date</p></div>
          <pre><code class="language-javascript">hasEvent: function(date) {
    return (new Date(date).toDateString() in calendarEvents);
},

hasTodoEvent: function(date) {
    date = new Date(date);
    if (!(date.toDateString() in calendarEvents) || date &lt; today.toDateString()) {
        return false;
    }
    return calendarEvents[date.toDateString()].filter(function(event) {
        return !event.episode.isWatched();
    }).length &gt; 0;
},

markDayWatched: function(day, rootScope) {
    var str = day instanceof Date ? day.toDateString() : new Date(day).toDateString();
    if (str in calendarEvents) {
        calendarEvents[str].map(function(calEvent) {
            if (calEvent.episode.hasAired()) {
                calEvent.episode.markWatched(rootScope);
                //console.debug(&quot;Mark calendar eventwatched: &quot;, calEvent);
            }
        });
    }
},
markDayDownloaded: function(day, rootScope) {
    var str = day instanceof Date ? day.toDateString() : new Date(day).toDateString();
    if (str in calendarEvents) {
        calendarEvents[str].map(function(calEvent) {
            if (calEvent.episode.hasAired()) {
                calEvent.episode.markDownloaded(rootScope);
                //console.debug(&quot;Mark calendar eventdownloaded: &quot;, calEvent);
            }
        })
    }
},</code></pre>
          <section id="getEvents">
            <h1>getEvents</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>getEvents()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Return events for a date or an empty array</p></div>
          <pre><code class="language-javascript">getEvents: function(date) {
    var str = date instanceof Date ? date.toDateString() : new Date(date).toDateString();
    return (str in calendarEvents) ? calendarEvents[str] : [];
},

getTodoEvents: function(date) {
    var str = date instanceof Date ? date.toDateString() : new Date(date).toDateString();
    return (str in calendarEvents) ? calendarEvents[str].filter(function(event) {
        return !event.episode.isWatched();
    }) : [];
},</code></pre>
          <section id="getSeries">
            <h1>getSeries</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>getSeries()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Sort the series for a day, that are now grouped by ID_Serie. It needs to return<br />an array (so that it can be sorted) instead of an object, and cache it, for angular.<br />Cache is cleared and regenerated when an episode is added to the list.</p></div>
          <pre><code class="language-javascript">getSeries: function(date) {
    var str = date instanceof Date ? date.toDateString() : new Date(date).toDateString();
    if (!(str in calendarEpisodeSortCache)) { // no cache yet?
        var seriesForDay = seriesForDate[str] || {};
        calendarEpisodeSortCache[str] = Object.keys(seriesForDay).map(function(serieId) { // turn the object into an array
            return seriesForDay[serieId];
        }).sort(function(a, b) {
            return calendarEpisodeSort(a[0], b[0]); // and sort it by the first item in it.
        });
    }
    return calendarEpisodeSortCache[str];
}
        };

        return service;
    }
])</code></pre>
          <div class="footer site-footer">
            <div class="span site-footer-owner"><a href="https://github.com/mr-doc/mr-doc-theme-cayman">Cayman</a> is maintained by <a href="https://github.com/iwatakeshi">iwatakeshi</a>.</div>
            <div class="span site-footer-credits">This page was generated by <a href="https://github.com/mr-doc/mr-doc">Mr. Doc</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</div>
          </div>
        </div>
      </div>
    </section>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/affix.js"></script>
    <script src="../js/dropdown.js"></script>
    <script src="../js/scrollspy.js"></script>
    <script src="../js/prism.js"></script>
    <script src="../js/prism-bash.js"></script>
    <script>
      $(document).ready(function(){
        $('body').scrollspy({
          target: ".bs-docs-sidebar",
          offset: 40
        });
        $('#sidebar').affix({
          offset:{
            bottom:60,
            top: 60
          }
        }) 
      });
    </script>
  </body>
</html>