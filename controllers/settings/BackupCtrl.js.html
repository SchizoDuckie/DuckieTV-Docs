<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>DuckieTV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type="text/css">
    <link rel="stylesheet" href="../../css/bootstrap.css">
    <link rel="stylesheet" href="../../css/cayman.css">
    <link rel="stylesheet" href="../../css/prism.css">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">DuckieTV</h1>
      <h2 class="project-tagline">DuckieTV helps you manage your favorite TV Shows on a sweet calendar</h2><a href="https://npmjs.com/package/DuckieTV-Standalone" target="_blank" class="btn">View on npm</a>
    </section>
    <section data-spy="scroll" data-target=".scrollspy" class="main-content">
      <div class="row">
        <div class="col-md-3 col-xs-3 bs-docs-sidebar">
          <ul id="sidebar" class="nav nav-stacked fixed">
            <li><a href="../../index.html">Main</a></li>
            <li><a href="../../CRUD.entities.js.html">CRUD.entities.js</a></li>
            <li><a href="../../app.authHttpBackend.js.html">app.authHttpBackend.js</a></li>
            <li><a href="../../app.js.html">app.js</a></li>
            <li><a href="../../app.requestinterceptors.js.html">app.requestinterceptors.js</a></li>
            <li><a href="../../app.routes.js.html">app.routes.js</a></li>
            <li><a href="../../app.standalone.systray.js.html">app.standalone.systray.js</a></li>
            <li><a href="../../app.standalone.update.js.html">app.standalone.update.js</a></li>
            <li><a href="../../app.standalone.windowdressing.js.html">app.standalone.windowdressing.js</a></li>
            <li><a href="../../app.standalone.zoom.js.html">app.standalone.zoom.js</a></li>
            <li><a href="../../app.translate.js.html">app.translate.js</a></li>
            <li><a href="../../background.js.html">background.js</a></li>
            <li><a href="../../classes/RemoteAPI.js.html">classes/RemoteAPI.js</a></li>
            <li><a href="../../controllers/ActionBarCtrl.js.html">controllers/ActionBarCtrl.js</a></li>
            <li><a href="../../controllers/WatchlistCtrl.js.html">controllers/WatchlistCtrl.js</a></li>
            <li><a href="../../controllers/serieslist/LocalSeriesCtrl.js.html">controllers/serieslist/LocalSeriesCtrl.js</a></li>
            <li><a href="../../controllers/serieslist/SeriesListCtrl.js.html">controllers/serieslist/SeriesListCtrl.js</a></li>
            <li><a href="../../controllers/serieslist/TraktTVSearchCtrl.js.html">controllers/serieslist/TraktTVSearchCtrl.js</a></li>
            <li><a href="../../controllers/serieslist/TraktTVTrendingCtrl.js.html">controllers/serieslist/TraktTVTrendingCtrl.js</a></li>
            <li class="active"><a href="../../controllers/settings/BackupCtrl.js.html">controllers/settings/BackupCtrl.js
                <ul class="nav nav-stacked">
                  <li><a href="#createBackup"><i class="alert alert-info"></i><span>createBackup</span></a>
                  </li>
                  <li><a href="#importBackup"><i class="alert alert-info"></i><span>importBackup</span></a>
                  </li>
                  <li><a href="#wipeDatabase"><i class="alert alert-info"></i><span>wipeDatabase</span></a>
                  </li>
                </ul></a></li>
            <li><a href="../../controllers/settings/CalendarCtrl.js.html">controllers/settings/CalendarCtrl.js</a></li>
            <li><a href="../../controllers/settings/DisplayCtrl.js.html">controllers/settings/DisplayCtrl.js</a></li>
            <li><a href="../../controllers/settings/LanguageCtrl.js.html">controllers/settings/LanguageCtrl.js</a></li>
            <li><a href="../../controllers/settings/SerieTorrentSettingsCtrl.js.html">controllers/settings/SerieTorrentSettingsCtrl.js</a></li>
            <li><a href="../../controllers/settings/SettingsTorrentCtrl.js.html">controllers/settings/SettingsTorrentCtrl.js</a></li>
            <li><a href="../../controllers/settings/SubtitlesCtrl.js.html">controllers/settings/SubtitlesCtrl.js</a></li>
            <li><a href="../../controllers/settings/SyncCtrl.js.html">controllers/settings/SyncCtrl.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/Deluge.js.html">controllers/settings/TorrentClients/Deluge.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/Tixati.js.html">controllers/settings/TorrentClients/Tixati.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/Transmission.js.html">controllers/settings/TorrentClients/Transmission.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/Vuze.js.html">controllers/settings/TorrentClients/Vuze.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/qBittorrent.js.html">controllers/settings/TorrentClients/qBittorrent.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/qBittorrent32plus.js.html">controllers/settings/TorrentClients/qBittorrent32plus.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/uTorrentWebUI.js.html">controllers/settings/TorrentClients/uTorrentWebUI.js</a></li>
            <li><a href="../../controllers/settings/TraktTVCtrl.js.html">controllers/settings/TraktTVCtrl.js</a></li>
            <li><a href="../../controllers/settings/customSearchEngineCtrl.js.html">controllers/settings/customSearchEngineCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/AboutCtrl.js.html">controllers/sidepanel/AboutCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SettingsCtrl.js.html">controllers/sidepanel/SettingsCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelEpisodeCtrl.js.html">controllers/sidepanel/SidepanelEpisodeCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelSeasonCtrl.js.html">controllers/sidepanel/SidepanelSeasonCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelSeasonsCtrl.js.html">controllers/sidepanel/SidepanelSeasonsCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelSerieCtrl.js.html">controllers/sidepanel/SidepanelSerieCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelTraktSerieCtrl.js.html">controllers/sidepanel/SidepanelTraktSerieCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/TorrentCtrl.js.html">controllers/sidepanel/TorrentCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/TorrentDetailsCtrl.js.html">controllers/sidepanel/TorrentDetailsCtrl.js</a></li>
            <li><a href="../../directives/backgroundRotator.js.html">directives/backgroundRotator.js</a></li>
            <li><a href="../../directives/calendar.js.html">directives/calendar.js</a></li>
            <li><a href="../../directives/calendarEvent.js.html">directives/calendarEvent.js</a></li>
            <li><a href="../../directives/chromeTopSites.js.html">directives/chromeTopSites.js</a></li>
            <li><a href="../../directives/datePicker.js.html">directives/datePicker.js</a></li>
            <li><a href="../../directives/episodeDownloaded.js.html">directives/episodeDownloaded.js</a></li>
            <li><a href="../../directives/episodeWatched.js.html">directives/episodeWatched.js</a></li>
            <li><a href="../../directives/fastSearch.js.html">directives/fastSearch.js</a></li>
            <li><a href="../../directives/focusWatch.js.html">directives/focusWatch.js</a></li>
            <li><a href="../../directives/lazyBackground.js.html">directives/lazyBackground.js</a></li>
            <li><a href="../../directives/loadingSpinner.js.html">directives/loadingSpinner.js</a></li>
            <li><a href="../../directives/mouseWheelDown.js.html">directives/mouseWheelDown.js</a></li>
            <li><a href="../../directives/mouseWheelUp.js.html">directives/mouseWheelUp.js</a></li>
            <li><a href="../../directives/queryMonitor.js.html">directives/queryMonitor.js</a></li>
            <li><a href="../../directives/serieDetails.js.html">directives/serieDetails.js</a></li>
            <li><a href="../../directives/serieheader.js.html">directives/serieheader.js</a></li>
            <li><a href="../../directives/seriesList.js.html">directives/seriesList.js</a></li>
            <li><a href="../../directives/sidePanel.js.html">directives/sidePanel.js</a></li>
            <li><a href="../../directives/stopEvent.js.html">directives/stopEvent.js</a></li>
            <li><a href="../../directives/subtitleDialog.js.html">directives/subtitleDialog.js</a></li>
            <li><a href="../../directives/targetBlank.js.html">directives/targetBlank.js</a></li>
            <li><a href="../../directives/torrentDialog.js.html">directives/torrentDialog.js</a></li>
            <li><a href="../../directives/torrentRemoteControl.js.html">directives/torrentRemoteControl.js</a></li>
            <li><a href="../../services/AutoDownloadService.js.html">services/AutoDownloadService.js</a></li>
            <li><a href="../../services/BaseHTTPApi.js.html">services/BaseHTTPApi.js</a></li>
            <li><a href="../../services/CalendarEvents.js.html">services/CalendarEvents.js</a></li>
            <li><a href="../../services/ChromeStorageSyncTarget.js.html">services/ChromeStorageSyncTarget.js</a></li>
            <li><a href="../../services/DuckieTorrent.js.html">services/DuckieTorrent.js</a></li>
            <li><a href="../../services/EpisodeWatchedMonitor.js.html">services/EpisodeWatchedMonitor.js</a></li>
            <li><a href="../../services/FavoritesService.js.html">services/FavoritesService.js</a></li>
            <li><a href="../../services/FileReader.js.html">services/FileReader.js</a></li>
            <li><a href="../../services/FormlyLoaderService.js.html">services/FormlyLoaderService.js</a></li>
            <li><a href="../../services/GoogleImages.js.html">services/GoogleImages.js</a></li>
            <li><a href="../../services/IMDB.js.html">services/IMDB.js</a></li>
            <li><a href="../../services/MigrationService.js.html">services/MigrationService.js</a></li>
            <li><a href="../../services/Netflix.js.html">services/Netflix.js</a></li>
            <li><a href="../../services/NotificationService.js.html">services/NotificationService.js</a></li>
            <li><a href="../../services/OpenSubtitles.js.html">services/OpenSubtitles.js</a></li>
            <li><a href="../../services/PowderPlayer.js.html">services/PowderPlayer.js</a></li>
            <li><a href="../../services/SceneNameResolver.js.html">services/SceneNameResolver.js</a></li>
            <li><a href="../../services/SceneXemResolver.js.html">services/SceneXemResolver.js</a></li>
            <li><a href="../../services/SettingsService.js.html">services/SettingsService.js</a></li>
            <li><a href="../../services/StorageSyncService.js.html">services/StorageSyncService.js</a></li>
            <li><a href="../../services/SyncManager.js.html">services/SyncManager.js</a></li>
            <li><a href="../../services/TorrentClients/BaseTorrentClient.js.html">services/TorrentClients/BaseTorrentClient.js</a></li>
            <li><a href="../../services/TorrentClients/Deluge.js.html">services/TorrentClients/Deluge.js</a></li>
            <li><a href="../../services/TorrentClients/Tixati.js.html">services/TorrentClients/Tixati.js</a></li>
            <li><a href="../../services/TorrentClients/TorrentData.js.html">services/TorrentClients/TorrentData.js</a></li>
            <li><a href="../../services/TorrentClients/Transmission.js.html">services/TorrentClients/Transmission.js</a></li>
            <li><a href="../../services/TorrentClients/Vuze.js.html">services/TorrentClients/Vuze.js</a></li>
            <li><a href="../../services/TorrentClients/qBittorrent.js.html">services/TorrentClients/qBittorrent.js</a></li>
            <li><a href="../../services/TorrentClients/qBittorrent32plus.js.html">services/TorrentClients/qBittorrent32plus.js</a></li>
            <li><a href="../../services/TorrentClients/uTorrent.js.html">services/TorrentClients/uTorrent.js</a></li>
            <li><a href="../../services/TorrentClients/uTorrentWebUI.js.html">services/TorrentClients/uTorrentWebUI.js</a></li>
            <li><a href="../../services/TorrentFreak.js.html">services/TorrentFreak.js</a></li>
            <li><a href="../../services/TorrentHashListService.js.html">services/TorrentHashListService.js</a></li>
            <li><a href="../../services/TorrentMonitor.js.html">services/TorrentMonitor.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/GenericTorrentSearchEngine.js.html">services/TorrentSearchEngines/GenericTorrentSearchEngine.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/Kickass.js.html">services/TorrentSearchEngines/Kickass.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/KickassMirrorResolver.js.html">services/TorrentSearchEngines/KickassMirrorResolver.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/Nyaa.js.html">services/TorrentSearchEngines/Nyaa.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/RarBG.js.html">services/TorrentSearchEngines/RarBG.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/ShowRSS.js.html">services/TorrentSearchEngines/ShowRSS.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/Strike.js.html">services/TorrentSearchEngines/Strike.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/ThePirateBay.js.html">services/TorrentSearchEngines/ThePirateBay.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/ThePirateBayMirrorResolver.js.html">services/TorrentSearchEngines/ThePirateBayMirrorResolver.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/TorrentSearchEngines.js.html">services/TorrentSearchEngines/TorrentSearchEngines.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/Torrentz.eu.js.html">services/TorrentSearchEngines/Torrentz.eu.js</a></li>
            <li><a href="../../services/TraktTVStorageSyncTarget.js.html">services/TraktTVStorageSyncTarget.js</a></li>
            <li><a href="../../services/TraktTVTrending.js.html">services/TraktTVTrending.js</a></li>
            <li><a href="../../services/TraktTVUpdateService.js.html">services/TraktTVUpdateService.js</a></li>
            <li><a href="../../services/TraktTVv2.js.html">services/TraktTVv2.js</a></li>
            <li><a href="../../services/UpgradeNotificationService.js.html">services/UpgradeNotificationService.js</a></li>
            <li><a href="../../services/WatchlistCheckerService.js.html">services/WatchlistCheckerService.js</a></li>
            <li><a href="../../services/WatchlistService.js.html">services/WatchlistService.js</a></li>
            <li><a href="../../utility.js.html">utility.js</a></li>
          </ul>
        </div>
        <div class="col-md-9">
          <div class="description"><p>Handles creating and importing a backup.</p><p>The backup format is a simple JSON file that has the following structure:</p><p>{<br />&quot;settings&quot;: {<br />  // serialized settings<br />},<br />&quot;series&quot;: {<br /> <SHOW_TVDB_ID> : [ // array of objects<br />     {<br />         &quot;TVDB_ID&quot;: <Episode_TVDB_ID>,<br />         &quot;watchedAt&quot;: <timestamp watchedAt>||null,<br />         &quot;downloaded&quot;: 1<br />     },<br />     // repeat<br />   ],<br />   // repeat<br /> }</p></div>
          <pre><code class="language-javascript">DuckieTV.controller('BackupCtrl', [&quot;$rootScope&quot;, &quot;$scope&quot;, &quot;dialogs&quot;, &quot;$filter&quot;, &quot;FileReader&quot;, &quot;TraktTVv2&quot;, &quot;SettingsService&quot;, &quot;FavoritesService&quot;, &quot;CalendarEvents&quot;, &quot;$q&quot;, &quot;$state&quot;,
    function($rootScope, $scope, dialogs, $filter, FileReader, TraktTVv2, SettingsService, FavoritesService, CalendarEvents, $q, $state) {

        $scope.backupString = false;
        $scope.wipeBeforeImport = false;
        $scope.declined = false;
        $scope.series = [];</code></pre>
          <section id="createBackup">
            <h1>createBackup</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>$scope.createBackup()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Select all series from the database in the format described above, serialize them as a data uri string<br />that&#39;s set up on the $scope.backupString, so that it can be used as a trigger for<br /><a ng-if="backupString" download="DuckieTV.backup" ng-href="{{ backupString }}">Backup ready! Click to download.</a></p></div>
          <pre><code class="language-javascript">$scope.createBackup = function() {
    $scope.backupTime = new Date();
    // Fetch all the series
    CRUD.executeQuery('select Series.TVDB_ID from Series').then(function(series) {
        var out = {
            settings: {},
            series: {}
        };
        // Store all the settings
        for (var i = 0; i &lt; localStorage.length; i++) {
            if (localStorage.key(i).indexOf('database.version') &gt; -1) continue;
            if (localStorage.key(i).indexOf('trakttv.trending.cache') &gt; -1) continue;
            if (localStorage.key(i).indexOf('trakttv.lastupdated.trending') &gt; -1) continue;
            out.settings[localStorage.key(i)] = localStorage.getItem(localStorage.key(i));
        }
        // Store all the series
        while (serie = series.next()) {
            out.series[serie.get('TVDB_ID')] = [];
        }

        // Store watched episodes for each serie
        CRUD.executeQuery('select Series.TVDB_ID, Episodes.TVDB_ID as epTVDB_ID, Episodes.watchedAt, Episodes.downloaded from Series left join Episodes on Episodes.ID_Serie = Series.ID_Serie where Episodes.downloaded == 1 or  Episodes.watchedAt is not null').then(function(res) {
            while (row = res.next()) {
                out.series[row.get('TVDB_ID')].push({
                    'TVDB_ID': row.get('epTVDB_ID'),
                    'watchedAt': new Date(row.get('watchedAt')).getTime(),
                    'downloaded': 1
                })
            }
            var blob = new Blob([angular.toJson(out, true)], {
                type: 'text/json'
            });
            $scope.backupString = URL.createObjectURL(blob);

            $scope.$digest();
        });
    });
}

$scope.isAdded = function(tvdb_id) {
    return FavoritesService.isAdded(tvdb_id);
};

$scope.isAdding = function(tvdb_id) {
    return FavoritesService.isAdding(tvdb_id);
};


$scope.restore = function() {
    console.log(&quot;Import backup!&quot;, $scope);
    FavoritesService.flushAdding();
    $scope.series = [];
    if ($scope.wipeBeforeImport) {
        $scope.wipeDatabase();
    } else {
        importBackup();
    }
}</code></pre>
          <section id="importBackup">
            <h1>importBackup</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>importBackup()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Read the backup file and feed it to the FavoritesService to resolve and add.<br />The FavoritesService has a method to automagically import the watched episodes<br />(which is a bit hacky as it should be part of the import)</p></div>
          <pre><code class="language-javascript">var importBackup = function() {
    FileReader.readAsText($scope.file, $scope)
        .then(function(result) {
            result = angular.fromJson(result);
            console.log(&quot;Backup read!&quot;, result);
            angular.forEach(result.settings, function(value, key) {
                if (key == 'utorrent.token') return; // skip utorrent auth token since it can be invalid.
                localStorage.setItem(key, value);
            });
            SettingsService.restore();
            SettingsService.set('autodownload.lastrun', new Date().getTime());
            angular.forEach(result.series, function(watched, TVDB_ID) {
                FavoritesService.adding(TVDB_ID);
                return TraktTVv2.resolveTVDBID(TVDB_ID).then(function(searchResult) {
                    return TraktTVv2.serie(searchResult.slug_id);
                }).then(function(serie) {
                    $scope.series.push(serie);
                    return FavoritesService.addFavorite(serie, watched);
                }).then(function() {
                    FavoritesService.added(TVDB_ID);
                });
            }, function(err) {
                console.error(&quot;ERROR!&quot;, err);
                FavoritesService.added(TVDB_ID);
                FavoritesService.addError(TVDB_ID, err);
            });
        });
}</code></pre>
          <section id="wipeDatabase">
            <h1>wipeDatabase</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>$scope.wipeDatabase()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Wipes the database of all series, seasons and episodes and removes all settings</p></div>
          <pre><code class="language-javascript">$scope.wipeDatabase = function() {
    var dlg = dialogs.confirm($filter('translate')('BACKUPCTRLjs/wipe/hdr'),
        $filter('translate')('BACKUPCTRLjs/wipe/desc')
    );
    dlg.result.then(function(btn) {
        var db = CRUD.EntityManager.getAdapter().db;
        for (var i in localStorage) {
            if (i.indexOf('database.version') == 0) continue;
            if (i.indexOf('utorrent.token') == 0) continue;
            localStorage.removeItem(i);
        };
        FavoritesService.favorites = [];
        FavoritesService.favoriteIDs = [];
        FavoritesService.flushAdding();
        CalendarEvents.clearCache();

        return Promise.all(['Series', 'Seasons', 'Episodes'].map(function(table) {
            return db.execute('DELETE from ' + table + ' where 1').then(function(result) {
                console.log(&quot;Database Deleted&quot;);
                return true;
            })
        })).then(function() {
            importBackup();
        });
    }, function(btn) {
        $scope.declined = true;
    });
};

$scope.refreshDatabase = function() {
    FavoritesService.favorites.map(function(serie) {
        FavoritesService.adding(serie.TVDB_ID);
        return TraktTVv2.resolveTVDBID(serie.TVDB_ID).then(function(s) {
            return TraktTVv2.serie(s.slug_id)
        }).then(function(s) {
            return FavoritesService.addFavorite(s).then(function() {
                $rootScope.$broadcast('storage:update');
                FavoritesService.added(s.tvdb_id);
            });
        }, function(err) {
            console.error(&quot;Error adding show!&quot;, err);
            FavoritesService.added(serie.TVDB_ID);
            FavoritesService.addError(serie.TVDB_ID, err);
        });
    });
}
    }
]);</code></pre>
          <div class="footer site-footer">
            <div class="span site-footer-owner"><a href="https://github.com/mr-doc/mr-doc-theme-cayman">Cayman</a> is maintained by <a href="https://github.com/iwatakeshi">iwatakeshi</a>.</div>
            <div class="span site-footer-credits">This page was generated by <a href="https://github.com/mr-doc/mr-doc">Mr. Doc</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</div>
          </div>
        </div>
      </div>
    </section>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/affix.js"></script>
    <script src="../../js/dropdown.js"></script>
    <script src="../../js/scrollspy.js"></script>
    <script src="../../js/prism.js"></script>
    <script src="../../js/prism-bash.js"></script>
    <script>
      $(document).ready(function(){
        $('body').scrollspy({
          target: ".bs-docs-sidebar",
          offset: 40
        });
        $('#sidebar').affix({
          offset:{
            bottom:60,
            top: 60
          }
        }) 
      });
    </script>
  </body>
</html>