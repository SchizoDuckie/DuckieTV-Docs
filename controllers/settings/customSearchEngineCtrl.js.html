<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>DuckieTV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type="text/css">
    <link rel="stylesheet" href="../../css/bootstrap.css">
    <link rel="stylesheet" href="../../css/cayman.css">
    <link rel="stylesheet" href="../../css/prism.css">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">DuckieTV</h1>
      <h2 class="project-tagline">DuckieTV helps you manage your favorite TV Shows on a sweet calendar</h2><a href="https://npmjs.com/package/DuckieTV-Standalone" target="_blank" class="btn">View on npm</a>
    </section>
    <section data-spy="scroll" data-target=".scrollspy" class="main-content">
      <div class="row">
        <div class="col-md-3 col-xs-3 bs-docs-sidebar">
          <ul id="sidebar" class="nav nav-stacked fixed">
            <li><a href="../../index.html">Main</a></li>
            <li><a href="../../CRUD.entities.js.html">CRUD.entities.js</a></li>
            <li><a href="../../app.authHttpBackend.js.html">app.authHttpBackend.js</a></li>
            <li><a href="../../app.js.html">app.js</a></li>
            <li><a href="../../app.requestinterceptors.js.html">app.requestinterceptors.js</a></li>
            <li><a href="../../app.routes.js.html">app.routes.js</a></li>
            <li><a href="../../app.standalone.systray.js.html">app.standalone.systray.js</a></li>
            <li><a href="../../app.standalone.update.js.html">app.standalone.update.js</a></li>
            <li><a href="../../app.standalone.windowdressing.js.html">app.standalone.windowdressing.js</a></li>
            <li><a href="../../app.standalone.zoom.js.html">app.standalone.zoom.js</a></li>
            <li><a href="../../app.translate.js.html">app.translate.js</a></li>
            <li><a href="../../background.js.html">background.js</a></li>
            <li><a href="../../classes/RemoteAPI.js.html">classes/RemoteAPI.js</a></li>
            <li><a href="../../controllers/ActionBarCtrl.js.html">controllers/ActionBarCtrl.js</a></li>
            <li><a href="../../controllers/WatchlistCtrl.js.html">controllers/WatchlistCtrl.js</a></li>
            <li><a href="../../controllers/serieslist/LocalSeriesCtrl.js.html">controllers/serieslist/LocalSeriesCtrl.js</a></li>
            <li><a href="../../controllers/serieslist/SeriesListCtrl.js.html">controllers/serieslist/SeriesListCtrl.js</a></li>
            <li><a href="../../controllers/serieslist/TraktTVSearchCtrl.js.html">controllers/serieslist/TraktTVSearchCtrl.js</a></li>
            <li><a href="../../controllers/serieslist/TraktTVTrendingCtrl.js.html">controllers/serieslist/TraktTVTrendingCtrl.js</a></li>
            <li><a href="../../controllers/settings/BackupCtrl.js.html">controllers/settings/BackupCtrl.js</a></li>
            <li><a href="../../controllers/settings/CalendarCtrl.js.html">controllers/settings/CalendarCtrl.js</a></li>
            <li><a href="../../controllers/settings/DisplayCtrl.js.html">controllers/settings/DisplayCtrl.js</a></li>
            <li><a href="../../controllers/settings/LanguageCtrl.js.html">controllers/settings/LanguageCtrl.js</a></li>
            <li><a href="../../controllers/settings/SerieTorrentSettingsCtrl.js.html">controllers/settings/SerieTorrentSettingsCtrl.js</a></li>
            <li><a href="../../controllers/settings/SettingsTorrentCtrl.js.html">controllers/settings/SettingsTorrentCtrl.js</a></li>
            <li><a href="../../controllers/settings/SubtitlesCtrl.js.html">controllers/settings/SubtitlesCtrl.js</a></li>
            <li><a href="../../controllers/settings/SyncCtrl.js.html">controllers/settings/SyncCtrl.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/Deluge.js.html">controllers/settings/TorrentClients/Deluge.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/Tixati.js.html">controllers/settings/TorrentClients/Tixati.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/Transmission.js.html">controllers/settings/TorrentClients/Transmission.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/Vuze.js.html">controllers/settings/TorrentClients/Vuze.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/qBittorrent.js.html">controllers/settings/TorrentClients/qBittorrent.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/qBittorrent32plus.js.html">controllers/settings/TorrentClients/qBittorrent32plus.js</a></li>
            <li><a href="../../controllers/settings/TorrentClients/uTorrentWebUI.js.html">controllers/settings/TorrentClients/uTorrentWebUI.js</a></li>
            <li><a href="../../controllers/settings/TraktTVCtrl.js.html">controllers/settings/TraktTVCtrl.js</a></li>
            <li class="active"><a href="../../controllers/settings/customSearchEngineCtrl.js.html">controllers/settings/customSearchEngineCtrl.js
                <ul class="nav nav-stacked">
                </ul></a></li>
            <li><a href="../../controllers/sidepanel/AboutCtrl.js.html">controllers/sidepanel/AboutCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SettingsCtrl.js.html">controllers/sidepanel/SettingsCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelEpisodeCtrl.js.html">controllers/sidepanel/SidepanelEpisodeCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelSeasonCtrl.js.html">controllers/sidepanel/SidepanelSeasonCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelSeasonsCtrl.js.html">controllers/sidepanel/SidepanelSeasonsCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelSerieCtrl.js.html">controllers/sidepanel/SidepanelSerieCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/SidepanelTraktSerieCtrl.js.html">controllers/sidepanel/SidepanelTraktSerieCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/TorrentCtrl.js.html">controllers/sidepanel/TorrentCtrl.js</a></li>
            <li><a href="../../controllers/sidepanel/TorrentDetailsCtrl.js.html">controllers/sidepanel/TorrentDetailsCtrl.js</a></li>
            <li><a href="../../directives/backgroundRotator.js.html">directives/backgroundRotator.js</a></li>
            <li><a href="../../directives/calendar.js.html">directives/calendar.js</a></li>
            <li><a href="../../directives/calendarEvent.js.html">directives/calendarEvent.js</a></li>
            <li><a href="../../directives/chromeTopSites.js.html">directives/chromeTopSites.js</a></li>
            <li><a href="../../directives/datePicker.js.html">directives/datePicker.js</a></li>
            <li><a href="../../directives/episodeDownloaded.js.html">directives/episodeDownloaded.js</a></li>
            <li><a href="../../directives/episodeWatched.js.html">directives/episodeWatched.js</a></li>
            <li><a href="../../directives/fastSearch.js.html">directives/fastSearch.js</a></li>
            <li><a href="../../directives/focusWatch.js.html">directives/focusWatch.js</a></li>
            <li><a href="../../directives/lazyBackground.js.html">directives/lazyBackground.js</a></li>
            <li><a href="../../directives/loadingSpinner.js.html">directives/loadingSpinner.js</a></li>
            <li><a href="../../directives/mouseWheelDown.js.html">directives/mouseWheelDown.js</a></li>
            <li><a href="../../directives/mouseWheelUp.js.html">directives/mouseWheelUp.js</a></li>
            <li><a href="../../directives/queryMonitor.js.html">directives/queryMonitor.js</a></li>
            <li><a href="../../directives/serieDetails.js.html">directives/serieDetails.js</a></li>
            <li><a href="../../directives/serieheader.js.html">directives/serieheader.js</a></li>
            <li><a href="../../directives/seriesList.js.html">directives/seriesList.js</a></li>
            <li><a href="../../directives/sidePanel.js.html">directives/sidePanel.js</a></li>
            <li><a href="../../directives/stopEvent.js.html">directives/stopEvent.js</a></li>
            <li><a href="../../directives/subtitleDialog.js.html">directives/subtitleDialog.js</a></li>
            <li><a href="../../directives/targetBlank.js.html">directives/targetBlank.js</a></li>
            <li><a href="../../directives/torrentDialog.js.html">directives/torrentDialog.js</a></li>
            <li><a href="../../directives/torrentRemoteControl.js.html">directives/torrentRemoteControl.js</a></li>
            <li><a href="../../services/AutoDownloadService.js.html">services/AutoDownloadService.js</a></li>
            <li><a href="../../services/BaseHTTPApi.js.html">services/BaseHTTPApi.js</a></li>
            <li><a href="../../services/CalendarEvents.js.html">services/CalendarEvents.js</a></li>
            <li><a href="../../services/ChromeStorageSyncTarget.js.html">services/ChromeStorageSyncTarget.js</a></li>
            <li><a href="../../services/DuckieTorrent.js.html">services/DuckieTorrent.js</a></li>
            <li><a href="../../services/EpisodeWatchedMonitor.js.html">services/EpisodeWatchedMonitor.js</a></li>
            <li><a href="../../services/FavoritesService.js.html">services/FavoritesService.js</a></li>
            <li><a href="../../services/FileReader.js.html">services/FileReader.js</a></li>
            <li><a href="../../services/FormlyLoaderService.js.html">services/FormlyLoaderService.js</a></li>
            <li><a href="../../services/GoogleImages.js.html">services/GoogleImages.js</a></li>
            <li><a href="../../services/IMDB.js.html">services/IMDB.js</a></li>
            <li><a href="../../services/MigrationService.js.html">services/MigrationService.js</a></li>
            <li><a href="../../services/Netflix.js.html">services/Netflix.js</a></li>
            <li><a href="../../services/NotificationService.js.html">services/NotificationService.js</a></li>
            <li><a href="../../services/OpenSubtitles.js.html">services/OpenSubtitles.js</a></li>
            <li><a href="../../services/PowderPlayer.js.html">services/PowderPlayer.js</a></li>
            <li><a href="../../services/SceneNameResolver.js.html">services/SceneNameResolver.js</a></li>
            <li><a href="../../services/SceneXemResolver.js.html">services/SceneXemResolver.js</a></li>
            <li><a href="../../services/SettingsService.js.html">services/SettingsService.js</a></li>
            <li><a href="../../services/StorageSyncService.js.html">services/StorageSyncService.js</a></li>
            <li><a href="../../services/SyncManager.js.html">services/SyncManager.js</a></li>
            <li><a href="../../services/TorrentClients/BaseTorrentClient.js.html">services/TorrentClients/BaseTorrentClient.js</a></li>
            <li><a href="../../services/TorrentClients/Deluge.js.html">services/TorrentClients/Deluge.js</a></li>
            <li><a href="../../services/TorrentClients/Tixati.js.html">services/TorrentClients/Tixati.js</a></li>
            <li><a href="../../services/TorrentClients/TorrentData.js.html">services/TorrentClients/TorrentData.js</a></li>
            <li><a href="../../services/TorrentClients/Transmission.js.html">services/TorrentClients/Transmission.js</a></li>
            <li><a href="../../services/TorrentClients/Vuze.js.html">services/TorrentClients/Vuze.js</a></li>
            <li><a href="../../services/TorrentClients/qBittorrent.js.html">services/TorrentClients/qBittorrent.js</a></li>
            <li><a href="../../services/TorrentClients/qBittorrent32plus.js.html">services/TorrentClients/qBittorrent32plus.js</a></li>
            <li><a href="../../services/TorrentClients/uTorrent.js.html">services/TorrentClients/uTorrent.js</a></li>
            <li><a href="../../services/TorrentClients/uTorrentWebUI.js.html">services/TorrentClients/uTorrentWebUI.js</a></li>
            <li><a href="../../services/TorrentFreak.js.html">services/TorrentFreak.js</a></li>
            <li><a href="../../services/TorrentHashListService.js.html">services/TorrentHashListService.js</a></li>
            <li><a href="../../services/TorrentMonitor.js.html">services/TorrentMonitor.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/GenericTorrentSearchEngine.js.html">services/TorrentSearchEngines/GenericTorrentSearchEngine.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/Kickass.js.html">services/TorrentSearchEngines/Kickass.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/KickassMirrorResolver.js.html">services/TorrentSearchEngines/KickassMirrorResolver.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/Nyaa.js.html">services/TorrentSearchEngines/Nyaa.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/RarBG.js.html">services/TorrentSearchEngines/RarBG.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/ShowRSS.js.html">services/TorrentSearchEngines/ShowRSS.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/Strike.js.html">services/TorrentSearchEngines/Strike.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/ThePirateBay.js.html">services/TorrentSearchEngines/ThePirateBay.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/ThePirateBayMirrorResolver.js.html">services/TorrentSearchEngines/ThePirateBayMirrorResolver.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/TorrentSearchEngines.js.html">services/TorrentSearchEngines/TorrentSearchEngines.js</a></li>
            <li><a href="../../services/TorrentSearchEngines/Torrentz.eu.js.html">services/TorrentSearchEngines/Torrentz.eu.js</a></li>
            <li><a href="../../services/TraktTVStorageSyncTarget.js.html">services/TraktTVStorageSyncTarget.js</a></li>
            <li><a href="../../services/TraktTVTrending.js.html">services/TraktTVTrending.js</a></li>
            <li><a href="../../services/TraktTVUpdateService.js.html">services/TraktTVUpdateService.js</a></li>
            <li><a href="../../services/TraktTVv2.js.html">services/TraktTVv2.js</a></li>
            <li><a href="../../services/UpgradeNotificationService.js.html">services/UpgradeNotificationService.js</a></li>
            <li><a href="../../services/WatchlistCheckerService.js.html">services/WatchlistCheckerService.js</a></li>
            <li><a href="../../services/WatchlistService.js.html">services/WatchlistService.js</a></li>
            <li><a href="../../utility.js.html">utility.js</a></li>
          </ul>
        </div>
        <div class="col-md-9">
          <div class="description"></div>
          <pre><code class="language-javascript">DuckieTV.controller(&quot;customSearchEngineCtrl&quot;, [&quot;$scope&quot;, &quot;$injector&quot;, &quot;$http&quot;, &quot;$q&quot;, &quot;SettingsService&quot;, &quot;TorrentSearchEngines&quot;, &quot;dialogs&quot;,
    function($scope, $injector, $http, $q, SettingsService, TorrentSearchEngines, dialogs) {

        var self = this;
        self.status = 'Idle';

        this.defaultEngines = Object.keys(TorrentSearchEngines.getSearchEngines());

        // List of current engines for testing. When actual saving functionality is added we need to load
        // the engines here first and then send them over to the dialog along with the $index of what one was selected
        this.customEngines = {
            'Torrentleech': {
                testSearch: 'test',
                name: 'Torrentleech.org',
                mirror: 'http://torrentleech.org', // http://yoursite.com',
                searchEndpoint: '/torrents/browse/index/query/%s',
                searchResultsContainer: '#torrenttable tr:not(:first-child)',
                releaseNameSelector: 'td.name .title a',
                releaseNameProperty: 'innerText',
                magnetSupported: false,
                magnetUrlSelector: '',
                magnetUrlProperty: '',
                torrentUrlSelector: 'td.quickdownload a',
                torrentUrlProperty: 'href',
                sizeSelector: 'td:nth-child(5)',
                sizeProperty: 'innerText',
                seederSelector: 'td.seeders',
                seederProperty: 'innerText',
                leecherSelector: 'td.leechers',
                leecherProperty: 'innerText',
                detailUrlSelector: 'td.name .title a',
                detailUrlProperty: 'href',
                loginRequired: true,
                loginPage: '/login.php',
                loginTestSelector: '#loginform'
            },
            'kat.cr': {
                testSearch: 'test',
                name: 'kat.cr',
                mirror: 'https://kat.cr', // http://yoursite.com',
                searchEndpoint: '/usearch/%s/?field=seeders&amp;sorder=desc',
                searchResultsContainer: 'table.data tr[id^=torrent]',
                releaseNameSelector: 'div.torrentname a.cellMainLink',
                releaseNameProperty: 'innerText',
                magnetSupported: true,
                magnetUrlSelector: 'a[title=&quot;Torrent magnet link&quot;]',
                magnetUrlProperty: 'href',
                torrentUrlSelector: '',
                torrentUrlProperty: '',
                sizeSelector: 'td:nth-child(2)',
                sizeProperty: 'innerText',
                seederSelector: 'td:nth-child(5)',
                seederProperty: 'innerText',
                leecherSelector: 'td:nth-child(6)',
                leecherProperty: 'innerText',
                detailUrlSelector: 'div.torrentname a.cellMainLink',
                detailUrlProperty: 'href'
            }
        };

        this.test = function(index) {
            self.status = 'creating test client';
            self.model = angular.copy(this.customEngines[Object.keys(this.customEngines)[index]]);

            var testClient = new GenericTorrentSearchEngine({
                mirror: this.model.mirror,
                noMagnet: this.model.magnetUrlSelector.length &lt; 2, // hasMagnet,
                loginRequired: this.model.loginRequired,
                loginPage: this.model.loginPage,
                loginTestSelector: this.model.loginTestSelector,
                includeBaseURL: true, // this.model.includeBaseUrl,
                endpoints: {
                    search: this.model.searchEndpoint,
                    details: [this.model.detailUrlSelector, this.model.detailUrlProperty]
                },
                selectors: {
                    resultContainer: this.model.searchResultsContainer,
                    releasename: [this.model.releaseNameSelector, this.model.releaseNameProperty],
                    magnetUrl: [this.model.magnetUrlSelector, this.model.magnetUrlProperty],
                    torrentUrl: [this.model.torrentUrlSelector, this.model.torrentUrlProperty],
                    size: [this.model.sizeSelector, this.model.sizeProperty],
                    seeders: [this.model.seederSelector, this.model.seederProperty],
                    leechers: [this.model.leecherSelector, this.model.leecherProperty],
                    detailUrl: [this.model.detailUrlSelector, this.model.detailUrlProperty],

                }
            }, $q, $http, $injector);

            self.status = &quot;Executing test search&quot;;
            testClient.search(this.model.testSearch).then(function(results) {
                self.status = results.length &gt; 0 ? 'Working!' : 'No results for search query :( ';
                $scope.$applyAsync();
            });
        };

        // Disabling currently does nothing atm
        this.disable = function(name, remove) {
            // Delete the engine instead of disable it
            if (remove) {
                TorrentSearchEngines.removeSearchEngine(name);
                this.status = &quot;Removed Search Engine &quot; + name;
            } else {
                TorrentSearchEngines.disableSearchEngine(name);
                this.status = &quot;Disabled Search Engine &quot; + name;
            }
        };

        // Enabling currently does nothing atm
        this.enable = function(name) {
            TorrentSearchEngines.enableSearchEngine(name);
        };

        this.openDialog = function(index, addNew) {
            // Opens dialog and sends list of current engines and the index of the one we are editing
            dialogs.create('templates/customSearchEngineDialog.html', 'customSearchEngineDialogCtrl as cse', {
                engine: self.customEngines[Object.keys(self.customEngines)[index]],
                isNew: addNew
            }, {
                size: 'lg'
            });
        };
    }
])

.controller('customSearchEngineDialogCtrl', ['$scope', &quot;$injector&quot;, &quot;$http&quot;, &quot;$q&quot;, &quot;$timeout&quot;, &quot;$modalInstance&quot;, &quot;data&quot;, &quot;TorrentSearchEngines&quot;, &quot;FormlyLoader&quot;,
    function($scope, $injector, $http, $q, $timeout, $modalInstance, data, TorrentSearchEngines, FormlyLoader) {

        var self = this;
        this.isNew = data.isNew;

        // Function to push log messages onto the page, pushes new message to top of array
        this.pageLog = [];
        var pageLog = function(message) {
            if (message) {
                self.pageLog.unshift(message);
            }
        };

        pageLog(&quot;Initializing&quot;);



        this.add = function() {
            pageLog(&quot;Attempting to add new Engine&quot;);
            // Note: SchizoDuckie recommended adding a checkbox for the noMagnet value
            // Note2: If a magneturl is provided it will ignore the torrentUrl if noMagnet is enabled otherwise it will use torrentUrl
            // Note3: A torrenturl will still be generated so entereing a torrenturl isn't needed if a magneturl is entered
            TorrentSearchEngines.registerSearchEngine(this.model.name, getTestClient());
            pageLog(&quot;Hopefully added engine&quot;);
        };



        var getTestClient = function() {
            return new GenericTorrentSearchEngine({

                mirror: self.model.mirror,
                noMagnet: self.model.magnetUrlSelector.length &lt; 2, // hasMagnet,
                includeBaseURL: true, // this.model.includeBaseUrl,
                loginRequired: self.model.loginRequired,
                loginPage: self.model.loginPage,
                loginTestSelector: self.model.loginTestSelector,
                endpoints: {
                    search: self.model.searchEndpoint,
                    details: [self.model.detailUrlSelector, self.model.detailUrlProperty]
                },
                selectors: {
                    resultContainer: self.model.searchResultsContainer,
                    releasename: [self.model.releaseNameSelector, self.model.releaseNameProperty],
                    magnetUrl: [self.model.magnetUrlSelector, self.model.magnetUrlProperty],
                    torrentUrl: [self.model.torrentUrlSelector, self.model.torrentUrlProperty],
                    size: [self.model.sizeSelector, self.model.sizeProperty],
                    seeders: [self.model.seederSelector, self.model.seederProperty],
                    leechers: [self.model.leecherSelector, self.model.leecherProperty],
                    detailUrl: [self.model.detailUrlSelector, self.model.detailUrlProperty]
                }
            }, $q, $http, $injector);

        };

        this.test = function() {
            pageLog(&quot;Creating testing client and Executing test search&quot;);
            getTestClient().search(self.model.testSearch).then(function(results) {
                pageLog(results.length &gt; 0 ? &quot;Test search working!&quot; : &quot;No results for search query :(&quot;);
                $scope.$applyAsync();
            });
        };

        var revalidateRowSelectors = function() {
            self.fields.map(function(field) {
                if (field.fieldGroup &amp;&amp; field.fieldGroup.length == 3 &amp;&amp; field.fieldGroup[0].formControl) {
                    field.fieldGroup[0].formControl.$validate();
                }
            });
        };


        pageLog(&quot;Loaded Attribute Whitelist&quot;);

        var cachedResult = null;
        var firstResult = null;

        function getCachedScraper(forceRefresh) {
            return $q(function(resolve, reject) {
                if (!cachedResult || forceRefresh) {
                    return getTestClient().executeSearch(self.model.testSearch).then(function(result) {
                        cachedResult = new HTMLScraper(result.data);
                        console.info(&quot;Executed new testsearch&quot;, cachedResult);
                        resolve(cachedResult);
                    });
                } else {
                    console.info(&quot;Returning cached result&quot;, cachedResult);
                    resolve(cachedResult);
                }
            });
        }

        FormlyLoader.setMapping('validators', {
            searchResultsContainer: {
                expression: function($viewValue, $modelValue, scope) {
                    return getCachedScraper().then(function(d) {
                        try {
                            var results = d.querySelectorAll($viewValue);
                            console.log(&quot;Results: &quot;, results);
                            if (!results || results.length === 0) {
                                self.model.infoMessages[scope.options.key] = 'No results found.';
                                throw new Error(&quot;no results found&quot;);
                            } else {
                                firstResult = results[0];
                                self.model.infoMessages[scope.options.key] = results.length + ' results found.';
                                revalidateRowSelectors();
                                return true;
                            }
                        } catch (E) {
                            self.model.infoMessages[scope.options.key] = E.message;
                            throw E;
                        }
                    });

                }
            },
            propertySelector: {
                expression: function($viewValue, $modelValue, scope) {
                    console.warn(scope.options.key + &quot; validate!&quot;);
                    return $q(function(resolve, reject) {
                        if (firstResult) {
                            try {
                                var property = self.model[scope.options.key.replace('Selector', 'Property')];
                                console.warn(&quot;Property for &quot; + scope.options.key + &quot;: &quot; + property, $viewValue, firstResult.querySelector($viewValue), firstResult.querySelector($viewValue)[self.model[property]], firstResult.querySelector($viewValue).getAttribute(property));
                                var el = firstResult.querySelector($viewValue);
                                self.model.infoMessages[scope.options.key] = (property == 'href' || property == 'src') ? el.getAttribute(property) : el[property];
                            } catch (E) {
                                self.model.infoMessages[scope.options.key] = E.message;
                            }
                            resolve();
                        } else {
                            throw &quot;no results.&quot;;
                        }
                    });
                }
            },
            attributeSelector: {
                expression: function($viewValue, $modelValue, scope) {
                    return $q(function(resolve) {
                        resolve();
                        setTimeout(function() {
                            revalidateRowSelectors();
                        });
                    });
                }
            },
            loginPage: {
                expression: function($viewValue, $modelValue, scope) {
                    return $http.get(self.model.mirror + $viewValue).then(function(result) {
                        self.model.infoMessages[scope.options.key] = 'Login page found';
                    }, function(err) {
                        throw &quot;Page not found &quot; + err.message;
                    });
                }
            },
            loginTestSelector: {
                expression: function($viewValue, $modelValue, scope) {
                    return getCachedScraper().then(function(d) {
                        try {
                            var results = d.querySelectorAll($viewValue);
                            console.log(&quot;Results: &quot;, results);
                            if (!results || results.length === 0) {
                                self.model.infoMessages[scope.options.key] = 'No results found, but assuming loggedin';
                            } else {
                                self.model.infoMessages[scope.options.key] = 'Not loggedin test OK';
                            }
                        } catch (E) {
                            self.model.infoMessages[scope.options.key] = E.message;
                            throw E;
                        }
                    });

                }
            }
        });

        FormlyLoader.setMapping('options', {
            attributeWhitelist: [{
                name: 'href',
            }, {
                name: 'innerText',
            }, {
                name: 'title',
            }, {
                name: 'src',
            }, {
                name: 'alt',
            }]
        });

        FormlyLoader.setMapping('modelOptions', {
            keyup: {
                &quot;updateOn&quot;: &quot;keyup&quot;,
                &quot;debounce&quot;: 200
            }
        });

        FormlyLoader.load('CustomSearchEngine').then(function(fields) {
            if (data.engine &amp;&amp; !data.isNew) {
                pageLog(&quot;Engine detected that isn't new, editing mode&quot;);
                self.model = data.engine;
            } else if (data.isNew) {
                pageLog(&quot;New engine detected, adding mode&quot;);
                self.model = {};
            }

            self.model.infoMessages = {
                'releaseNameSelector': 'testing'
            };

            self.fields = fields;
            console.log(&quot;Loaded!&quot;, fields);
        });

        this.testResults = {
            'searchResultsContainer': 'woei'

        };

        $scope.cancel = function() {
            $modalInstance.dismiss('Canceled');
        };
    }
]);</code></pre>
          <div class="footer site-footer">
            <div class="span site-footer-owner"><a href="https://github.com/mr-doc/mr-doc-theme-cayman">Cayman</a> is maintained by <a href="https://github.com/iwatakeshi">iwatakeshi</a>.</div>
            <div class="span site-footer-credits">This page was generated by <a href="https://github.com/mr-doc/mr-doc">Mr. Doc</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</div>
          </div>
        </div>
      </div>
    </section>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/affix.js"></script>
    <script src="../../js/dropdown.js"></script>
    <script src="../../js/scrollspy.js"></script>
    <script src="../../js/prism.js"></script>
    <script src="../../js/prism-bash.js"></script>
    <script>
      $(document).ready(function(){
        $('body').scrollspy({
          target: ".bs-docs-sidebar",
          offset: 40
        });
        $('#sidebar').affix({
          offset:{
            bottom:60,
            top: 60
          }
        }) 
      });
    </script>
  </body>
</html>